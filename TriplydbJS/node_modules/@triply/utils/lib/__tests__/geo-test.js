"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
const chai = __importStar(require("chai"));
var expect = chai.expect;
const geo_1 = require("../geo");
describe("Geo", () => {
    describe("parseWkt", () => {
        it("Shouldn't parse POINT EMPTY", () => {
            const pointZ = "POINT EMPTY";
            expect(() => geo_1.parseWkt(pointZ)).to.throw("Could not parse wkt.");
        });
        it("POLYGON EMPTY should have empty coordinate list", () => {
            const poly = "POLYGON EMPTY";
            expect(geo_1.parseWkt(poly).wkt.coordinates).to.have.lengthOf(0);
        });
        it("Shouldn't parse random string", () => {
            const pointZ = "Most values tested here are POINT (30 40)";
            expect(() => geo_1.parseWkt(pointZ)).to.throw("Could not parse wkt.");
        });
        it("Shouldn't parse undefined", () => {
            expect(() => geo_1.parseWkt(undefined)).to.throw("No wkt string given.");
        });
        it("With invalid CRS", function () {
            expect(() => geo_1.parseWkt("<http://crs> POLYGON ((30 10, 40 40, 20 40, 10 20, 30 10))")).to.throw("CRS http://crs is not supported.");
        });
        it("Parses GEOMETRYCOLLECTION correctly", () => {
            const GeometryCollection = "GEOMETRYCOLLECTION (POINT (40 10),LINESTRING (10 10, 20 20, 10 40),POLYGON ((40 40, 20 45, 45 30, 40 40)))";
            const wkt = geo_1.parseWkt(GeometryCollection).wkt;
            expect(wkt.type === "GeometryCollection");
            if (wkt.type === "GeometryCollection") {
                expect(wkt.geometries).lengthOf(3);
                expect(wkt.geometries[0].type).to.equal("Point");
                expect(wkt.geometries[1].type).to.equal("LineString");
                expect(wkt.geometries[2].type).to.equal("Polygon");
            }
        });
        describe("Undefined segments", () => {
            it("LineString no content", () => {
                expect(() => geo_1.parseWkt("LINESTRING(,)")).to.throw("Invalid WKT segment");
            });
            it("LineString empty segment", () => {
                expect(() => geo_1.parseWkt("LINESTRING(0 0,1 1,2 2, , 4 4)")).to.throw("Invalid WKT segment");
            });
            it("Multipolygon empty segment", () => {
                expect(() => geo_1.parseWkt("MULTIPOLYGON (((40 40, 20 45, 45 30, 40 40)),((20 35, , 10 10, 30 5, 45 20, 20 35),(30 20, 20 15, 20 25, 30 20)))")).to.throw("Invalid WKT segment");
            });
            it("GEOMETRYCOLLECTION empty segment", () => {
                expect(() => geo_1.parseWkt("GEOMETRYCOLLECTION (POINT (40 10),LINESTRING (10 10, , 10 40),POLYGON ((40 40, 20 45, 45 30, 40 40)))")).to.throw("Invalid WKT segment");
            });
        });
    });
    describe("getFirstPointFromWktString", () => {
        describe("happy tests", () => {
            it("should parse point correctly", () => {
                const pointWkt = "POINT (30 10)";
                const firstCoords = geo_1.getFirstPointFromWktString(pointWkt);
                expect(firstCoords === null || firstCoords === void 0 ? void 0 : firstCoords.longitude).to.equal(30);
                expect(firstCoords === null || firstCoords === void 0 ? void 0 : firstCoords.latitude).to.equal(10);
            });
            it("should parse line correctly", () => {
                const lineWkt = "LINESTRING (30 10, 10 30, 40 40)";
                const firstCoords = geo_1.getFirstPointFromWktString(lineWkt);
                expect(firstCoords === null || firstCoords === void 0 ? void 0 : firstCoords.longitude).to.equal(30);
                expect(firstCoords === null || firstCoords === void 0 ? void 0 : firstCoords.latitude).to.equal(10);
            });
            it("should parse polygon correctly", () => {
                const polygonWkt = "POLYGON ((30 10, 40 40, 20 40, 10 20, 30 10)) ";
                const firstCoords = geo_1.getFirstPointFromWktString(polygonWkt);
                expect(firstCoords === null || firstCoords === void 0 ? void 0 : firstCoords.longitude).to.equal(30);
                expect(firstCoords === null || firstCoords === void 0 ? void 0 : firstCoords.latitude).to.equal(10);
                const twoPolygon = "POLYGON ((35 10, 45 45, 15 40, 10 20, 35 10),(20 30, 35 35, 30 20, 20 30))";
                const twoPolygonCoords = geo_1.getFirstPointFromWktString(twoPolygon);
                expect(twoPolygonCoords === null || twoPolygonCoords === void 0 ? void 0 : twoPolygonCoords.longitude).to.equal(35);
                expect(twoPolygonCoords === null || twoPolygonCoords === void 0 ? void 0 : twoPolygonCoords.latitude).to.equal(10);
            });
            it("should parse Multipoint correctly", () => {
                const multiPointWkt = "MULTIPOINT ((10 40), (40 30), (20 20), (30 10))";
                const firstCoords = geo_1.getFirstPointFromWktString(multiPointWkt);
                expect(firstCoords === null || firstCoords === void 0 ? void 0 : firstCoords.longitude).to.equal(10);
                expect(firstCoords === null || firstCoords === void 0 ? void 0 : firstCoords.latitude).to.equal(40);
                const multiPointWkt2 = "MULTIPOINT (10 40, 40 30, 20 20, 30 10)";
                const firstCoords2 = geo_1.getFirstPointFromWktString(multiPointWkt2);
                expect(firstCoords2 === null || firstCoords2 === void 0 ? void 0 : firstCoords2.longitude).to.equal(10);
                expect(firstCoords2 === null || firstCoords2 === void 0 ? void 0 : firstCoords2.latitude).to.equal(40);
            });
            it("should parse multiLineString correctly", () => {
                const lineWkt = "MULTILINESTRING ((10 15, 20 20, 10 40),(40 40, 30 30, 40 20, 30 10))";
                const firstCoords = geo_1.getFirstPointFromWktString(lineWkt);
                expect(firstCoords === null || firstCoords === void 0 ? void 0 : firstCoords.longitude).to.equal(10);
                expect(firstCoords === null || firstCoords === void 0 ? void 0 : firstCoords.latitude).to.equal(15);
            });
            it("should parse MultiPolygon correctly", () => {
                const multiPolygon = "MULTIPOLYGON (((30 20, 45 40, 10 40, 30 20)),((15 5, 40 10, 10 20, 5 10, 15 5)))";
                const firstCoords = geo_1.getFirstPointFromWktString(multiPolygon);
                expect(firstCoords === null || firstCoords === void 0 ? void 0 : firstCoords.longitude).to.equal(30);
                expect(firstCoords === null || firstCoords === void 0 ? void 0 : firstCoords.latitude).to.equal(20);
                expect(firstCoords === null || firstCoords === void 0 ? void 0 : firstCoords.crs).to.be.undefined;
                const multiPolygon2 = "MULTIPOLYGON (((40 45, 20 45, 45 30, 40 40)),((20 35, 10 30, 10 10, 30 5, 45 20, 20 35),(30 20, 20 15, 20 25, 30 20)))";
                const firstCoords2 = geo_1.getFirstPointFromWktString(multiPolygon2);
                expect(firstCoords2 === null || firstCoords2 === void 0 ? void 0 : firstCoords2.longitude).to.equal(40);
                expect(firstCoords2 === null || firstCoords2 === void 0 ? void 0 : firstCoords2.latitude).to.equal(45);
                expect(firstCoords === null || firstCoords === void 0 ? void 0 : firstCoords.crs).to.be.undefined;
            });
            it("should parse GeometryCollection correctly", () => {
                const multiPolygon = "GEOMETRYCOLLECTION (POINT (40 10),LINESTRING (10 10, 20 20, 10 40),POLYGON ((40 40, 20 45, 45 30, 40 40)))";
                const firstCoords = geo_1.getFirstPointFromWktString(multiPolygon);
                expect(firstCoords === null || firstCoords === void 0 ? void 0 : firstCoords.longitude).to.equal(40);
                expect(firstCoords === null || firstCoords === void 0 ? void 0 : firstCoords.latitude).to.equal(10);
                expect(firstCoords === null || firstCoords === void 0 ? void 0 : firstCoords.crs).to.be.undefined;
            });
            it("Can handle Z", () => {
                const pointZ = "POINT Z (30 10 5)";
                const wkt = geo_1.getFirstPointFromWktString(pointZ);
                expect(wkt === null || wkt === void 0 ? void 0 : wkt.longitude).to.equal(30);
                expect(wkt === null || wkt === void 0 ? void 0 : wkt.latitude).to.equal(10);
                expect(wkt === null || wkt === void 0 ? void 0 : wkt.crs).to.be.undefined;
                expect(wkt === null || wkt === void 0 ? void 0 : wkt.crs).to.be.undefined;
            });
            it("With valid CRS", function () {
                const parsed = geo_1.getFirstPointFromWktString("<http://www.opengis.net/def/crs/EPSG/0/4326> POLYGON ((30 10, 40 40, 20 40, 10 20, 30 10))");
                expect(parsed === null || parsed === void 0 ? void 0 : parsed.longitude).to.equal(30);
                expect(parsed === null || parsed === void 0 ? void 0 : parsed.latitude).to.equal(10);
                expect(parsed === null || parsed === void 0 ? void 0 : parsed.crs).to.equal("http://www.opengis.net/def/crs/EPSG/0/4326");
            });
        });
        describe("Errors should result in undefined", () => {
            it("Shouldn't parse EMPTY", () => {
                const pointZ = "POINT EMPTY";
                const wkt = geo_1.getFirstPointFromWktString(pointZ);
                expect(wkt).to.be.undefined;
            });
            it("Shouldn't parse Pointy polygon", () => {
                const pointZ = "MULTIPOLYGON (30 10)";
                const wkt = geo_1.getFirstPointFromWktString(pointZ);
                expect(wkt).to.be.undefined;
            });
            it("Shouldn't parse random string", () => {
                const pointZ = "Most values tested here are POINT (30 40)";
                const wkt = geo_1.getFirstPointFromWktString(pointZ);
                expect(wkt).to.be.undefined;
            });
            it("Shouldn't parse undefined", () => {
                const wkt = geo_1.getFirstPointFromWktString(undefined);
                expect(wkt).to.be.undefined;
            });
            it("With invalid CRS", function () {
                const wkt = geo_1.getFirstPointFromWktString("<http://crs> POLYGON ((30 10, 40 40, 20 40, 10 20, 30 10))");
                expect(wkt).to.be.undefined;
            });
        });
    });
});
//# sourceMappingURL=geo-test.js.map