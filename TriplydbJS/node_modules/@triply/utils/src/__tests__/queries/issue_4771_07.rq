prefix bag: <http://bag.basisregistraties.overheid.nl/def/bag#>
prefix bgt: <https://bgt.basisregistraties.overheid.nl/bgt/def/>
prefix bif: <http://www.openlinksw.com/schemas/bif#>
prefix brt: <http://brt.basisregistraties.overheid.nl/def/top10nl#>
prefix geo: <http://www.opengis.net/ont/geosparql#>
prefix imgeo: <http://definities.geostandaarden.nl/def/imgeo#>
prefix pand: <http://bag.basisregistraties.overheid.nl/bag/id/pand/>
prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#>
select distinct
  ?bagShape
    ("red" as ?bagShapeColor)
    ("6" as ?bagShapeZ)
    ("12" as ?bagShapeHeight)
    (strdt(concat('<h1><a href="',str(?bag),'" target="_blank">BAG</a></h1><h2>',str(?openbareRuimteNaam),' ',str(?huisnummer),', ',str(?postcode),', ',str(?woonplaatsNaam),'</h2><h3>Oppervlakte: ',str(?oppervlakte),'mÂ²<br>Bouwjaar: ',str(?bouwjaar),'</h3>'),rdf:HTML) as ?bagShapeLabel)
  ?bgtShape
    ("green" as ?bgtShapeColor)
    ("12" as ?bgtShapeZ)
    ("18" as ?bgtShapeHeight)
    (strdt(concat('<h1><a href="',str(?bgt),'" target="_blank">BGT</a></h1>'),rdf:HTML) as ?bgtShapeLabel)
  ?brtShape
    ("blue" as ?brtShapeColor)
    ("0" as ?brtShapeZ)
    ("8" as ?brtShapeHeight)
    (strdt(concat('<h1><a href="',str(?brt),'" target="_blank">BRT</a></h1>'),rdf:HTML) as ?brtShapeLabel)
{
  service <https://api.labs.kadaster.nl/datasets/kadaster/knowledge-graph/services/knowledge-graph/sparql> {
    optional {
      ?brt
        geo:hasGeometry/geo:asWKT ?brtShape;
        geo:sfOverlaps ?bag.
    }
    ?nummeraanduiding
      bag:bijbehorendeOpenbareRuimte
        [ bag:bijbehorendeWoonplaats/bag:naamWoonplaats ?woonplaatsNaam;
          bag:naamOpenbareRuimte ?openbareRuimteNaam ];
      bag:huisnummer ?huisnummer;
      bag:postcode ?postcode.
    ?bag a bag:Pand;
      geo:hasGeometry/geo:asWKT ?bagShape;
      bag:oorspronkelijkBouwjaar ?bouwjaar.
    ?verblijfsobject
      bag:hoofdadres ?nummeraanduiding;
      bag:oppervlakte ?oppervlakte;
      bag:pandrelatering ?bag.
  }
  ?bgt
    bgt:bagPand ?bag;
    bgt:geometrie ?bgtShapeRd.
  filter not exists { ?bgt bgt:objectEindtijd []. }
  bind(bif:ST_Transform(?bgtShapeRd, 4326) as ?bgtShape)
  filter(!strstarts(str(?bgtShape),'POINT'))
}
limit 40